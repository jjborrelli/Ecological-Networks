# Motif Dictionary
fournode <- list(
  id14 = matrix(c(2,1,3,1,4,1), ncol = 2, byrow = T),
  id28 = matrix(c(3,1,4,1,1,2), ncol = 2, byrow = T),
  id30 = matrix(c(3,1,4,1,1,2,2,1), ncol = 2, byrow = T),
  id74 = matrix(c(2,1,3,2,4,1), ncol = 2, byrow = T),
  id76 = matrix(c(3,1,3,2,4,1), ncol = 2, byrow = T),
  id78 = matrix(c(2,1,3,1,4,1,3,2), ncol = 2, byrow = T),
  id90 = matrix(c(2,1,1,2,3,2,4,1), ncol = 2, byrow = T),
  id92 = matrix(c(1,2,3,1,3,2,4,1), ncol = 2, byrow = T), 
  id94 = matrix(c(1,2,2,1,4,1,3,1,3,2), ncol = 2, byrow = T),
  id204 = matrix(c(3,1,3,2,4,1,4,2), ncol = 2, byrow = T),
  id206 = matrix(c(2,1,3,1,4,1,3,2,4,2), ncol = 2, byrow = T),
  id222 = matrix(c(2,1,3,1,4,1,3,2,4,2,1,2), ncol = 2, byrow = T),
  id280 = matrix(c(1,2,1,3,4,1), ncol = 2, byrow = T),
  id282 = matrix(c(1,2,1,3,4,1,2,1), ncol = 2, byrow = T),
  id286 = matrix(c(1,2,1,3,4,1,2,1,3,1), ncol = 2, byrow = T),
  id328 = matrix(c(1,3,4,1,3,2), ncol = 2, byrow = T),
  id330 = matrix(c(2,1,1,3,4,1,3,2), ncol = 2, byrow = T),
  id332 = matrix(c(4,1,3,2,3,1,1,3), ncol = 2, byrow = T),
  id334 = matrix(c(4,1,3,2,3,1,1,3,2,1), ncol = 2, byrow = T),
  id344 = matrix(c(4,1,3,2,3,1,1,3,1,2), ncol = 2, byrow = T),
  id346 = matrix(c(2,1,1,3,4,1,3,2,1,2), ncol = 2, byrow = T),
  id348 = matrix(c(4,1,3,2,3,1,1,3,1,2), ncol = 2, byrow = T),
  id350 = matrix(c(4,1,3,2,3,1,1,3,2,1,1,2), ncol = 2, byrow = T),
  id390 = matrix(c(2,1,1,3,3,1,4,2), ncol = 2, byrow = T),
  id392 = matrix(c(1,3,4,1,4,2), ncol = 2, byrow = T),
  id394 = matrix(c(2,1,1,3,4,1,4,2), ncol = 2, byrow = T),
  id396 = matrix(c(3,1,1,3,4,1,4,2), ncol = 2, byrow = T),
  id398 = matrix(c(2,1,1,3,3,1,4,2,4,1), ncol = 2, byrow = T),
  id404 = matrix(c(1,3,3,1,1,2,4,2), ncol = 2, byrow = T),
  id406 = matrix(c(1,3,3,1,1,2,2,1,4,2), ncol = 2, byrow = T),
  id408 = matrix(c(1,3,2,1,4,1,4,2), ncol = 2, byrow = T),
  id410 = matrix(c(2,1,1,3,4,2,4,1,1,2), ncol = 2, byrow = T),
  id412 = matrix(c(1,2,3,1,1,3,4,1,4,2), ncol = 2, byrow = T),
  id414 = matrix(c(1,2,3,1,1,3,4,1,4,2,2,1), ncol = 2, byrow = T),
  id454 = matrix(c(2,1,1,3,3,1,3,2,4,2), ncol = 2, byrow = T),
  id456 = matrix(c(1,3,4,1,2,3,4,2), ncol = 2, byrow = T),
  id458 = matrix(c(1,3,2,1,4,1,4,2,3,2), ncol = 2, byrow = T),
  id460 = matrix(c(1,3,3,1,4,1,4,2,3,2), ncol = 2, byrow = T),
  id462 = matrix(c(2,1,1,3,3,1,3,2,4,1,4,2), ncol = 2, byrow = T),
  id468 = matrix(c(1,2,1,3,3,1,3,2,4,2), ncol = 2, byrow = T),
  id470 = matrix(c(1,3,3,1,1,2,2,1,3,2,4,1,4,2), ncol = 2, byrow = T),
  id472 = matrix(c(1,3,1,2,4,1,4,2,3,2), ncol = 2, byrow = T),
  id474 = matrix(c(1,3,1,2,2,1,3,2,4,1,4,2), ncol = 2, byrow = T),
  id476 = matrix(c(1,3,3,1,1,2,3,2,4,1,4,2), ncol = 2, byrow = T),
  id478 = matrix(c(1,3,3,1,1,2,2,1,3,2,4,1,4,2), ncol = 2, byrow = T),
  id856 = matrix(c(1,3,1,2,2,3,3,2,4,1), ncol = 2, byrow = T),
  id858 = matrix(c(1,3,1,2,2,1,2,3,3,2,4,1), ncol = 2, byrow = T),
  id862 = matrix(c(1,3,3,1,1,2,2,1,2,3,3,2,4,1), ncol = 2, byrow = T),
  id904 = matrix(c(1,3,2,3,4,1,4,2), ncol = 2, byrow = T),
  id906 = matrix(c(1,3,2,1,2,3,4,1,4,2), ncol = 2, byrow = T),
  id908 = matrix(c(1,3,3,1,4,1,4,2,2,3), ncol = 2, byrow = T),
  id910 = matrix(c(1,3,3,1,2,1,2,3,4,1,4,2), ncol = 2, byrow = T),
  id922 = matrix(c(1,3,1,2,2,1,2,3,4,1,4,2), ncol = 2, byrow = T),
  id924 = matrix(c(1,3,3,1,1,2,2,3,4,1,4,2), ncol = 2, byrow = T),
  id926 = matrix(c(1,3,3,1,1,2,2,1,4,1,4,2,2,3), ncol = 2, byrow = T),
  id972 = matrix(c(1,3,3,1,2,3,3,2,4,1,4,2), ncol = 2, byrow = T),
  id974 = matrix(c(1,3,3,1,2,1,2,3,3,2,4,1,4,2), ncol = 2, byrow = T),
  id990 = matrix(c(1,3,3,1,1,2,2,1,2,3,3,2,4,1,4,2), ncol = 2, byrow = T),
  id2184 = matrix(c(4,1,4,2,4,3), ncol = 2, byrow = T),
  id2186 = matrix(c(4,1,4,2,4,3,2,1), ncol = 2, byrow = T),
  id2190 = matrix(c(4,1,4,2,4,3,2,1,3,1), ncol = 2, byrow = T),
  id2202 = matrix(c(1,2,2,1,4,1,4,2,4,3), ncol = 2, byrow = T),
  id2204 = matrix(c(3,1,1,2,4,1,4,2,4,3), ncol = 2, byrow = T),
  id2206 = matrix(c(1,2,2,1,3,1,4,1,4,2,4,3), ncol = 2, byrow = T),
  id2252 = matrix(c(3,1,3,2,4,1,4,2,4,3), ncol = 2, byrow = T),
  id2254 = matrix(c(3,1,2,1,3,2,4,1,4,2,4,3), ncol = 2, byrow = T),
  id2270 = matrix(c(1,2,2,1,3,1,3,2,4,1,4,2,4,3), ncol = 2, byrow = T),
  id2458 = matrix(c(1,2,2,1,1,3,4,1,4,2,4,3), ncol = 2, byrow = T),
  id2462 = matrix(c(1,3,3,1,1,2,2,1,4,1,4,2,4,3), ncol = 2, byrow = T),
  id2506 = matrix(c(1,3,2,1,3,2,4,1,4,2,4,3), ncol = 2, byrow = T),
  id2510 = matrix(c(1,3,3,1,2,1,3,2,4,1,4,2,4,3), ncol = 2, byrow = T),
  id2524 = matrix(c(1,2,1,3,3,1,3,2,4,1,4,2,4,3), ncol = 2, byrow = T),
  id2526 = matrix(c(1,2,2,1,1,3,3,1,3,2,4,1,4,2,4,3), ncol = 2, byrow = T),
  id3038 = matrix(c(1,2,2,1,1,3,3,1,3,2,2,3,4,1,4,2,4,3), ncol = 2, byrow = T),
  id4370 = matrix(c(1,3,1,2,2,1,4,1), ncol = 2, byrow = T),
  id4374 = matrix(c(1,3,3,1,1,2,2,1,4,1), ncol = 2, byrow = T),
  id4382 = matrix(c(1,2,2,1,1,3,3,1,1,4,4,1), ncol = 2, byrow = T),
  id4418 = matrix(c(1,3,2,1,1,4,3,2), ncol = 2, byrow = T),
  id4420 = matrix(c(1,3,3,1,3,2,1,4), ncol = 2, byrow = T),
  id4422 = matrix(c(1,3,3,1,3,2,2,1,1,4), ncol = 2, byrow = T),
  id4424 = matrix(c(1,3,3,2,4,1,1,4), ncol = 2, byrow = T),
  id4426 = matrix(c(1,3,2,1,3,2,1,4,4,1), ncol = 2, byrow = T),
  id4428 = matrix(c(1,3,3,1,1,4,4,1,3,2), ncol = 2, byrow = T),
  id4430 = matrix(c(1,3,3,1,2,1,1,4,4,1,3,2), ncol = 2, byrow = T),
  id4434 = matrix(c(3,1,1,2,2,1,1,4,3,2), ncol = 2, byrow = T),
  id4436 = matrix(c(1,3,3,1,1,2,1,4,3,2), ncol = 2, byrow = T),
  id4438 = matrix(c(1,2,2,1,1,3,3,1,3,2,1,4), ncol = 2, byrow = T),
  id4440 = matrix(c(1,3,1,2,1,4,4,1,3,2), ncol = 2, byrow = T),
  id4442 = matrix(c(1,3,1,2,2,1,1,4,4,1,3,2), ncol = 2, byrow = T),
  id4444 = matrix(c(1,3,3,1,1,4,4,1,1,2,3,2), ncol = 2, byrow = T),
  id4446 = matrix(c(1,3,3,1,1,4,4,1,1,2,2,1,3,2), ncol = 2, byrow = T),
  id4546 = matrix(c(1,3,2,1,1,4,4,2,3,2), ncol = 2, byrow = T),
  id4548 = matrix(c(1,3,3,1,1,4,3,2,4,2), ncol = 2, byrow = T),
  id4550 = matrix(c(1,3,3,1,2,1,1,4,3,2,4,2), ncol = 2, byrow = T),
  id4556 = matrix(c(1,3,3,1,1,4,3,2,4,2,4,1), ncol = 2, byrow = T),
  id4558 = matrix(c(1,3,3,1,1,4,4,1,4,2,2,1,3,2), ncol = 2, byrow = T),
  id4562 = matrix(c(1,3,1,2,2,1,3,2,4,2,1,4), ncol = 2, byrow = T),
  id4564 = matrix(c(1,3,3,1,1,2,1,4,3,2,4,2), ncol = 2, byrow = T),
  id4566 = matrix(c(1,3,3,1,1,2,2,1,3,2,4,2,1,4), ncol = 2, byrow = T),
  id4572 = matrix(c(1,3,3,1,1,2,3,2,4,2,1,4,4,1), ncol = 2, byrow = T),
  id4574 = matrix(c(1,2,2,1,1,3,3,1,1,4,4,1,3,2,4,2), ncol = 2, byrow = T),
  id4678 = matrix(c(3,1,2,1,1,4,3,2,2,3), ncol = 2, byrow = T),
  id4682 = matrix(c(2,1,1,4,4,1,2,3,3,2), ncol = 2, byrow = T),
  id4686 = matrix(c(3,1,2,1,1,4,4,1,2,3,3,2), ncol = 2, byrow = T),
  id4692 = matrix(c(3,1,1,2,1,4,2,3,3,2), ncol = 2, byrow = T),
  id4694 = matrix(c(1,2,2,1,1,4,2,3,3,2,3,1), ncol = 2, byrow = T),
  id4698 = matrix(c(1,2,2,1,2,3,3,2,1,4,4,1), ncol = 2, byrow = T),
  id4700 = matrix(c(3,1,1,2,1,4,4,1,2,3,3,2), ncol = 2, byrow = T),
  id4702 = matrix(c(3,1,1,2,2,1,1,4,4,1,2,3,3,2), ncol = 2, byrow = T),
  id4740 = matrix(c(3,1,4,2,1,4,2,3), ncol = 2, byrow = T),
  id4742 = matrix(c(3,1,4,2,1,4,2,3,2,1), ncol = 2, byrow = T),
  id4748 = matrix(c(3,1,4,2,1,4,2,3,4,1), ncol = 2, byrow = T),
  id4750 = matrix(c(3,1,2,1,1,4,4,1,2,3,4,2), ncol = 2, byrow = T),
  id4758 = matrix(c(1,2,2,1,3,1,4,2,2,3,1,4), ncol = 2, byrow = T),
  id4764 = matrix(c(1,2,3,1,2,3,1,4,4,1,4,2), ncol = 2, byrow = T),
  id4766 = matrix(c(1,2,2,1,1,4,4,1,3,1,2,3,4,2), ncol = 2, byrow = T),
  id4812 = matrix(c(3,1,4,2,1,4,4,1,2,3,3,2), ncol = 2, byrow = T),
  id4814 = matrix(c(3,1,4,2,1,4,4,1,2,3,3,2,2,1), ncol = 2, byrow = T),
  id4830 = matrix(c(3,1,4,2,1,4,4,1,2,3,3,2,2,1,1,2), ncol = 2, byrow = T),
  id4946 = matrix(c(1,2,2,1,1,3,1,4,2,3,3,2), ncol = 2, byrow = T),
  id4950 = matrix(c(1,2,2,1,1,3,3,1,2,3,3,2,1,4), ncol = 2, byrow = T),
  id4952 = matrix(c(1,2,1,3,1,4,4,1,2,3,3,2), ncol = 2, byrow = T),
  id4954 = matrix(c(1,2,1,3,1,4,4,1,2,3,3,2,2,1), ncol = 2, byrow = T),
  id4958 = matrix(c(1,2,1,3,1,4,4,1,2,3,3,2,2,1,3,1), ncol = 2, byrow = T),
  id4994 = matrix(c(2,1,1,3,1,4,2,3,4,2), ncol = 2, byrow = T),
  id4998 = matrix(c(2,1,1,3,1,4,2,3,4,2,3,1), ncol = 2, byrow = T),
  id5002 = matrix(c(2,1,1,3,1,4,2,3,4,2,4,1), ncol = 2, byrow = T),
  id5004 = matrix(c(1,3,3,1,1,4,4,1,2,3,4,2), ncol = 2, byrow = T),
  id5006 = matrix(c(1,3,3,1,2,1,1,4,4,1,2,3,4,2), ncol = 2, byrow = T),
  id5010 = matrix(c(1,3,1,2,2,1,1,4,2,3,4,2), ncol = 2, byrow = T),
  id5012 = matrix(c(1,3,3,1,1,2,1,4,2,3,4,2), ncol = 2, byrow = T),
  id5014 = matrix(c(1,3,3,1,1,2,2,1,1,4,2,3,4,2), ncol = 2, byrow = T),
  id5016 = matrix(c(1,3,1,2,1,4,4,1,2,3,4,2), ncol = 2, byrow = T),
  id5018 = matrix(c(1,2,2,1,1,3,1,4,4,1,2,3,4,2), ncol = 2, byrow = T),
  id5020 = matrix(c(1,3,3,1,1,4,4,1,1,2,2,3,4,2), ncol = 2, byrow = T),
  id5022 = matrix(c(1,2,2,1,1,3,3,1,1,4,4,1,2,3,4,2), ncol = 2, byrow = T),
  id5058 = matrix(c(1,3,2,1,1,4,2,3,3,2,4,2), ncol = 2, byrow = T),
  id5062 = matrix(c(1,3,3,1,2,1,1,4,2,3,3,2,4,2), ncol = 2, byrow = T),
  id5064 = matrix(c(1,3,1,4,2,3,3,2,4,1,4,2), ncol = 2, byrow = T),
  id5066 = matrix(c(1,3,1,4,4,1,2,3,3,2,2,1,4,2), ncol = 2, byrow = T),
  id5068 = matrix(c(1,3,3,1,1,4,4,1,2,3,3,2,4,2), ncol = 2, byrow = T),
  id5070 = matrix(c(1,3,3,1,1,4,4,1,2,3,3,2,4,2,2,1), ncol = 2, byrow = T),
  id5074 = matrix(c(1,3,1,4,4,1,2,3,3,2,4,2,2,1,1,2), ncol = 2, byrow = T),
  id5076 = matrix(c(1,3,3,1,2,3,3,2,1,4,1,2,4,2), ncol = 2, byrow = T),
  id5078 = matrix(c(1,3,3,1,1,2,2,1,2,3,3,2,4,2,1,4), ncol = 2, byrow = T),
  id5080 = matrix(c(1,3,1,2,2,3,3,2,4,2,1,4,4,1), ncol = 2, byrow = T),
  id5082 = matrix(c(1,3,1,2,2,3,3,2,4,2,1,4,4,1,2,1), ncol = 2, byrow = T),
  id5084 = matrix(c(1,3,1,2,2,3,3,2,4,2,1,4,4,1,3,1), ncol = 2, byrow = T),
  is5086 = matrix(c(1,3,3,1,1,2,2,1,2,3,3,2,4,2,1,4,4,1), ncol = 2, byrow = T),
  id6342 = matrix(c(2,1,3,1,1,4,3,2,4,3,4,2), ncol = 2, byrow = T),
  id6348 = matrix(c(3,1,3,2,1,4,4,1,4,3,4,2), ncol = 2, byrow = T),
  id6350 = matrix(c(2,1,1,4,4,1,4,2,4,3,3,2,3,1), ncol = 2, byrow = T),
  id6356 = matrix(c(1,2,1,4,4,2,4,3,3,2,3,1), ncol = 2, byrow = T),
  id6358 = matrix(c(1,2,2,1,1,4,4,2,4,3,3,2,3,1), ncol = 2, byrow = T),
  id6364 = matrix(c(1,2,1,4,4,2,4,3,3,2,3,1,4,1), ncol = 2, byrow = T),
  id6366 = matrix(c(1,2,1,4,4,2,4,3,3,2,3,1,4,1,2,1), ncol = 2, byrow = T),
  id6550 = matrix(c(1,3,3,1,1,2,2,1,1,4,4,3,4,2), ncol = 2, byrow = T),
  id6552 = matrix(c(1,3,1,2,1,4,4,1,4,2,4,3), ncol = 2, byrow = T),
  id6554 = matrix(c(1,3,1,2,1,4,4,1,4,2,4,3,2,1), ncol = 2, byrow = T),
  id6558 = matrix(c(1,3,1,2,1,4,4,1,4,2,4,3,2,1,3,1), ncol = 2, byrow = T),
  id6598 = matrix(c(1,3,3,1,2,1,1,4,3,2,4,3,4,2), ncol = 2, byrow = T),
  id6602 = matrix(c(1,3,2,1,1,4,4,1,3,2,4,3,4,2), ncol = 2, byrow = T),
  id6604 = matrix(c(1,3,3,1,1,4,4,1,3,2,4,3,4,2), ncol = 2, byrow = T),
  id6606 = matrix(c(1,3,3,1,1,4,4,1,2,1,3,2,4,3,4,2), ncol = 2, byrow = T),
  id6614 = matrix(c(1,3,3,1,1,2,2,1,3,2,1,4,4,2,4,3), ncol = 2, byrow = T),
  id6616 = matrix(c(1,3,1,2,1,4,4,1,3,2,4,2,4,3), ncol = 2, byrow = T),
  id6618 = matrix(c(1,2,2,1,1,3,1,4,4,1,3,2,4,2,4,3), ncol = 2, byrow = T),
  id6620 = matrix(c(1,3,3,1,1,2,1,4,4,1,3,2,4,2,4,3), ncol = 2, byrow = T),
  id6622 = matrix(c(1,2,2,1,1,3,3,1,1,4,4,1,4,2,4,3), ncol = 2, byrow = T),
  id6854 = matrix(c(3,1,2,1,1,4,2,3,3,2,4,2,4,3), ncol = 2, byrow = T),
  id6858 = matrix(c(2,1,2,3,3,2,1,4,4,1,4,2,4,3), ncol = 2, byrow = T),
  id6862 = matrix(c(3,1,2,1,1,4,4,1,2,3,3,2,4,2,4,3), ncol = 2, byrow = T),
  id6870 = matrix(c(1,2,2,1,3,1,1,4,2,3,3,2,4,2,4,3), ncol = 2, byrow = T),
  id6874 = matrix(c(1,2,2,1,1,4,4,1,2,3,3,2,4,2,4,3), ncol = 2, byrow = T),
  id6876 = matrix(c(1,2,3,1,1,4,4,1,2,3,3,2,4,2,4,3), ncol = 2, byrow = T),
  id6878 = matrix(c(3,1,1,2,2,1,1,4,4,1,2,3,3,2,4,2,4,3), ncol = 2, byrow = T),
  id7126 = matrix(c(1,3,3,1,1,2,2,1,2,3,3,2,1,4,4,2,4,3), ncol = 2, byrow = T),
  id7128 = matrix(c(1,3,1,2,1,4,4,1,2,3,3,2,4,2,4,3), ncol = 2, byrow = T),
  id7130 = matrix(c(1,2,2,1,1,3,1,4,4,1,2,3,3,2,4,2,4,3), ncol = 2, byrow = T),
  id7134 = matrix(c(1,2,2,1,1,3,3,1,1,4,4,1,2,3,3,2,4,2,4,3), ncol = 2, byrow = T),
  id13142 = matrix(c(1,2,2,1,1,3,3,1,2,3,3,2,1,4,2,4), ncol = 2, byrow = T),
  id13146 = matrix(c(1,2,2,1,1,3,1,4,4,1,2,3,3,2,2,4), ncol = 2, byrow = T),
  id13148 = matrix(c(1,3,3,1,1,2,2,4,1,4,4,1,2,3,3,2), ncol = 2, byrow = T),
  id13150 = matrix(c(1,3,3,1,1,2,2,1,1,4,4,1,2,3,3,2,2,4), ncol = 2, byrow = T),
  id13260 = matrix(c(1,3,3,1,2,4,4,2,1,4,4,1,2,3,3,2), ncol = 2, byrow = T),
  id13262 = matrix(c(1,3,3,1,2,4,4,2,1,4,4,1,2,3,3,2,2,1), ncol = 2, byrow = T),
  id13278 = matrix(c(1,3,3,1,2,4,4,2,1,4,4,1,2,3,3,2,1,2,2,1), ncol = 2, byrow = T),
  id14678 = matrix(c(1,3,3,1,2,4,1,4,3,2,1,2,2,1,4,3), ncol = 2, byrow = T),
  id14686 = matrix(c(1,2,2,1,1,3,3,1,1,4,4,1,3,2,2,4,4,3), ncol = 2, byrow = T),
  id14790 = matrix(c(1,3,3,1,2,1,1,4,3,2,2,4,4,2,4,3), ncol = 2, byrow = T),
  id14798 = matrix(c(1,3,3,1,1,4,4,1,3,2,2,1,2,4,4,2,4,3), ncol = 2, byrow = T),
  id14810 = matrix(c(1,2,2,1,1,3,1,4,4,1,3,2,2,4,4,2,4,3), ncol = 2, byrow = T),
  id14812 = matrix(c(1,3,3,1,1,2,1,4,4,1,3,2,4,3,4,2,2,4), ncol = 2, byrow = T),
  id14814 = matrix(c(1,3,3,1,1,2,1,4,4,1,3,2,4,3,4,2,2,4,2,1), ncol = 2, byrow = T),
  id15258 = matrix(c(1,3,1,4,4,1,1,2,2,1,2,3,2,4,4,2,4,3), ncol = 2, byrow = T),
  id15262 = matrix(c(1,3,3,1,1,4,4,1,1,2,2,1,2,3,2,4,4,2,4,3), ncol = 2, byrow = T),
  id15310 = matrix(c(1,3,3,1,2,1,1,4,4,1,2,3,3,2,4,3), ncol = 2, byrow = T),
  id15326 = matrix(c(1,3,3,1,1,2,2,1,1,4,4,1,2,3,3,2,2,4,4,2,4,3), ncol = 2, byrow = T),
  id31710 = matrix(c(1,3,3,1,1,2,2,1,1,4,4,1,2,3,3,2,2,4,4,2,4,3,3,4), ncol = 2, byrow = T)
)


#fivenode <- list()
#for(i in 1:500){
#  connect = FALSE
#  while(!connect){
#    e <- sample(4:20, 1, prob = c(rep(.1, 7), rep(.03, 10)))
#    fivenode[[i]] <- erdos.renyi.game(5, p.or.m = e, type = "gnm", directed = T)  
#    
#    comp <- c()
#    for(j in 1:length(fivenode)){
#      if(length(fivenode) == 1){break}
#      if(j > 1){j <- j-1}
#      test <- sum(get.adjacency(fivenode[[i]]) == get.adjacency(fivenode[[j]])) == 25
#      comp <- c(comp, test)
#    }
#    if(sum(comp) >= 1){connect = FALSE}else{connect <- is.connected(fivenode[[i]])}
#  }
#  print(i)
#}


# Convert adjacency lists into graph objects
require(igraph)
fournode.gr <- lapply(fournode, graph.edgelist)

# Create adjacency matrices
fournode.am <- lapply(fournode.gr, get.adjacency, sparse = F)
#fivenode.am <- lapply(fivenode, get.adjacency, sparse = F)

# motif_counter function from "web_functions.R"
motif_counter <- function(graph.lists, webs = NULL){
  require(igraph)
  
  if(!is.list(graph.lists)){
    stop("The input should be a list of graph objects")
  }
  
  triad.count <- lapply(graph.lists, triad.census)
  triad.matrix <- matrix(unlist(triad.count), nrow = length(graph.lists), ncol = 16, byrow = T)
  colnames(triad.matrix) <- c("empty", "single", "mutual", "s5", "s4", "s1", "d4",
                              "d3", "s2", "s3","d8", "d2", "d1", "d5", "d7", "d6")
  
  triad.df <- as.data.frame(triad.matrix)
  
  motif.data.frame <- data.frame(web = webs, s1 = triad.df$s1, s2 = triad.df$s2, s3 = triad.df$s3, s4 = triad.df$s4, 
                                 s5 = triad.df$s5, d1 = triad.df$d1, d2 = triad.df$d2, d3 = triad.df$d3, d4 = triad.df$d4,
                                 d5 = triad.df$d5, d6 = triad.df$d6, d7 = triad.df$d7, d8 = triad.df$d8)
  
  return(motif.data.frame)
}

# count motifs
mot.4 <- motif_counter(fournode.gr, names(fournode.gr))
subcount.4 <- mot.4[,2:14]

#mot.5 <- motif_counter(fivenode, 1:301)
#subcount.5 <- mot.5[,2:14]

# Stability analysis functions from "motifAnalysis.R"
conversion <- function(tm){
  for(i in 1:nrow(tm)){
    for(j in 1:ncol(tm)){
      if(tm[i,j] == 1 & tm[j,i] == 0){tm[j,i] <- -1}
    }
  }
  return(tm)
}

ran.unif <- function(motmat){
  newmat <- apply(motmat, c(1,2), function(x){
    if(x==1){runif(1, 0, 10)}else if(x==-1){runif(1, -1, 0)} else{0}
  })
  diag(newmat) <- runif(nrow(newmat), -1, 0)
  return(newmat)
}

maxRE <- function(rmat){
  lam.max <- max(Re(eigen(rmat)$values))
  return(lam.max)
}

eig.analysis <- function(n, matrices){
  cols <- length(matrices)
  rows <- n
  eigenMATRIX <- matrix(0, nrow = rows, ncol = cols)
  for(i in 1:n){
    ranmat <- lapply(matrices, ran.unif)
    
    eigs <- sapply(ranmat, maxRE)
    eigenMATRIX[i,] <- eigs
  }
  return(eigenMATRIX)
}


# run the stability analysis on four node subgraphs
fourN.co <- lapply(fournode.am, conversion)
system.time(
emat <- eig.analysis(1000, fourN.co)
)

qss.4 <- apply(emat, 2, function(x){sum(x < 0)/length(x)})
names(qss.4) <- names(fournode.am)

num.edges <- sapply(fournode.am, sum)

plot(qss.4[names(sort(num.edges))])
table(num.edges)


results <- data.frame(edges = num.edges, qss = qss.4)

sub2 <- cbind(subcount.4[,1:5], other = rowSums(subcount.4[,6:13]))

m <- apply(sub2, 2, mean)
s <- apply(sub2, 2, sd)


z <- (sub2 - m)/s

z.test <-  as.matrix(z)
summary(glm(qss.4~z.test, family = "quasibinomial"))

results2 <- cbind(results, z)


# five node stability
fiveN.co <- lapply(fivenode.am, conversion)
system.time(
  emat5 <- eig.analysis(1000, fiveN.co)
)

qss.5 <- apply(emat5, 2, function(x){sum(x < 0)/length(x)})


num.edges5 <- sapply(fivenode.am, sum)

table(num.edges5)


results5 <- data.frame(edges = num.edges5, qss = qss.5)

sub5 <- cbind(subcount.5[,1:5], other = rowSums(subcount.5[,6:13]))

m5 <- apply(sub5, 2, mean)
s5 <- apply(sub5, 2, sd)


z5 <- (sub5 - m5)/s5

z.test5 <-  as.matrix(z5)
summary(glm(qss.5~z.test5, family = "quasibinomial"))
